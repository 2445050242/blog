(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{529:function(e,s,t){"use strict";t.r(s);var a=t(4),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("ul",[t("li",[t("h4",{attrs:{id:"api用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api用法"}},[e._v("#")]),e._v(" API用法")]),e._v(" "),t("ul",[t("li",[t("h5",{attrs:{id:"store-保存数据的地方，可以把它看成一个容器，整个应用只能有一个store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#store-保存数据的地方，可以把它看成一个容器，整个应用只能有一个store"}},[e._v("#")]),e._v(" =="),t("code",[e._v("Store")]),e._v("== 保存数据的地方，可以把它看成一个容器，整个应用只能有一个"),t("code",[e._v("Store")])])])]),e._v(" "),t("p",[t("code",[e._v("Redux")]),e._v(" 提供"),t("code",[e._v("createStore")]),e._v("这个函数，用来生成 "),t("code",[e._v("Store")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { createStore } from 'redux'\nconst store = createStore(reducer)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"state-数据集合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#state-数据集合"}},[e._v("#")]),e._v(" =="),t("code",[e._v("State")]),e._v("== 数据集合")])])]),e._v(" "),t("p",[e._v("当前时刻的 "),t("code",[e._v("State")]),e._v("，可以通过"),t("code",[e._v("store.getState()")]),e._v("拿到")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { createStore } from 'redux'\nconst store = createStore(reducer)\n\nconst state = store.getState()\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"action-view-发出的通知，表示-state-应该要发生变化了"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#action-view-发出的通知，表示-state-应该要发生变化了"}},[e._v("#")]),e._v(" =="),t("code",[e._v("Action")]),e._v("== "),t("code",[e._v("View")]),e._v(" 发出的通知，表示 "),t("code",[e._v("State")]),e._v(" 应该要发生变化了")])])]),e._v(" "),t("p",[t("code",[e._v("Action")]),e._v("是一个对象，其中的"),t("code",[e._v("type")]),e._v("属性是必须的，表示"),t("code",[e._v("Action")]),e._v("的名称")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const action = {\n  type: 'ADD_TODO',\n  payload: 'Learn Redux'\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[e._v("可以使用函数返回创建多个"),t("code",[e._v("Aciton")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const ADD_TODO = '添加 TODO'\n\nfunction addTodo(text) {\n  return {\n    type: ADD_TODO,\n    text\n  }\n}\n\nconst action = addTodo('Learn Redux')\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"store-dispatch-是-view-发出-action-的唯一方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#store-dispatch-是-view-发出-action-的唯一方法"}},[e._v("#")]),e._v(" =="),t("code",[e._v("store.dispatch()")]),e._v("== 是 "),t("code",[e._v("View")]),e._v(" 发出 "),t("code",[e._v("Action")]),e._v(" 的唯一方法")])])]),e._v(" "),t("p",[t("code",[e._v("store.dispatch")]),e._v("接受一个 "),t("code",[e._v("Action")]),e._v(" 对象作为参数，将它发送出去")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { createStore } from 'redux'\nconst store = createStore(reducer)\n\nstore.dispatch(addTodo('Learn Redux'))\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"reducer-state-的计算过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reducer-state-的计算过程"}},[e._v("#")]),e._v(" =="),t("code",[e._v("Reducer")]),e._v("== "),t("code",[e._v("State")]),e._v(" 的计算过程")])])]),e._v(" "),t("p",[t("code",[e._v("Reducer")]),e._v(" 是一个函数，它接受 "),t("code",[e._v("Action")]),e._v(" 和当前 "),t("code",[e._v("State")]),e._v(" 作为参数，返回一个新的 "),t("code",[e._v("State")]),e._v("，整个应用的初始状态，可以作为 "),t("code",[e._v("State")]),e._v(" 的默认值")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const defaultState = 0\nconst reducer = (state = defaultState, action) => {\n  switch (action.type) {\n    case 'ADD':\n      return state + action.payload\n    default: \n      return state\n  }\n}\n\nconst state = reducer(1, {\n  type: 'ADD',\n  payload: 2\n})\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br")])]),t("p",[t("code",[e._v("store.dispatch")]),e._v("方法会触发 "),t("code",[e._v("Reducer")]),e._v(" 的自动执行。为此，"),t("code",[e._v("Store")]),e._v(" 需要知道 "),t("code",[e._v("Reducer")]),e._v(" 函数，做法就是在生成 "),t("code",[e._v("Store")]),e._v(" 的时候，将 "),t("code",[e._v("Reducer")]),e._v(" 传入"),t("code",[e._v("createStore")]),e._v("方法")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { createStore } from 'redux'\nconst store = createStore(reducer)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("一系列 "),t("code",[e._v("Action")]),e._v(" 对象按照顺序作为一个数组")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const actions = [\n  { type: 'ADD', payload: 0 },\n  { type: 'ADD', payload: 1 },\n  { type: 'ADD', payload: 2 }\n]\n\nconst total = actions.reduce(reducer, 0) // 3\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("  注意点：  \n  - Reducer 函数最重要的特征是，它是一个纯函数  \n  - Reducer 函数里面不能改变 State，必须返回一个全新的对象\n")])])]),t("ul",[t("li",[t("h5",{attrs:{id:"store-subscribe-设置监听函数，一旦-state-发生变化，就自动执行这个函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#store-subscribe-设置监听函数，一旦-state-发生变化，就自动执行这个函数"}},[e._v("#")]),e._v(" =="),t("code",[e._v("store.subscribe()")]),e._v("== 设置监听函数，一旦 "),t("code",[e._v("State")]),e._v(" 发生变化，就自动执行这个函数")])])]),e._v(" "),t("p",[e._v("只要把 "),t("code",[e._v("View")]),e._v(" 的更新函数（对于 "),t("code",[e._v("React")]),e._v(" 项目，就是组件的"),t("code",[e._v("render")]),e._v("方法或"),t("code",[e._v("setState")]),e._v("方法）放入"),t("code",[e._v("listen")]),e._v("，就会实现 "),t("code",[e._v("View")]),e._v(" 的自动渲染")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { createStore } from 'redux'\nconst store = createStore(reducer)\n\nstore.subscribe(listener)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[t("code",[e._v("store.subscribe")]),e._v("方法返回一个函数，调用这个函数就可以解除监听")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("let unsubscribe = store.subscribe(() =>\n  console.log(store.getState())\n)\n\nunsubscribe()\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"combinereducers-用于-reducer-的拆分"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#combinereducers-用于-reducer-的拆分"}},[e._v("#")]),e._v(" =="),t("code",[e._v("combineReducers")]),e._v("== 用于 "),t("code",[e._v("Reducer")]),e._v(" 的拆分")])])]),e._v(" "),t("p",[e._v("你只要定义各个子 "),t("code",[e._v("Reducer")]),e._v(" 函数，然后用这个方法，将它们合成一个大的 "),t("code",[e._v("Reducer")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { combineReducers } from 'redux'\n\nconst chatReducer = combineReducers({\n  chatLog,\n  statusMessage,\n  userName\n})\n\nexport default todoApp\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("p",[e._v("可以把所有子 "),t("code",[e._v("Reducer")]),e._v(" 放在一个文件里面，然后统一引入")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { combineReducers } from 'redux'\nimport * as reducers from './reducers'\n\nconst reducer = combineReducers(reducers)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])])]),e._v(" "),t("li",[t("h4",{attrs:{id:"功能实现示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#功能实现示例"}},[e._v("#")]),e._v(" 功能实现示例")]),e._v(" "),t("ul",[t("li",[t("h5",{attrs:{id:"简单实现cretestore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单实现cretestore"}},[e._v("#")]),e._v(" 简单实现"),t("code",[e._v("creteStore")])])])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const createStore = (reducer) => {\n  let state\n  let listeners = []\n\n  const getState = () => state\n\n  const dispatch = (action) => {\n    state = reducer(state, action)\n    listeners.forEach(listeners => listener())\n  }\n\n  const subscribe = (listener) => {\n    listeners.push(listener)\n    return () => {\n      listeners = listeners.filter(l => l !== listener)\n    }\n  }\n\n  dispatch({})\n\n  return {getState, dispatch, subscribe}\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br"),t("span",{staticClass:"line-number"},[e._v("17")]),t("br"),t("span",{staticClass:"line-number"},[e._v("18")]),t("br"),t("span",{staticClass:"line-number"},[e._v("19")]),t("br"),t("span",{staticClass:"line-number"},[e._v("20")]),t("br"),t("span",{staticClass:"line-number"},[e._v("21")]),t("br"),t("span",{staticClass:"line-number"},[e._v("22")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"简单实现combinereducer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单实现combinereducer"}},[e._v("#")]),e._v(" 简单实现"),t("code",[e._v("combineReducer")])])])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const combineReducers = reducers => {\n  return (state = {}, action) => {\n    return Object.keys(reducers).reduce(\n      (nextState, key) => {\n        nextState[key] = reducers[key](state[key], action)\n        return nextState\n      },\n      {} \n    )\n  }\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"简单实现applymiddlewares"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单实现applymiddlewares"}},[e._v("#")]),e._v(" 简单实现"),t("code",[e._v("applyMiddlewares")])])])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("export default function applyMiddleware(...middlewares) {\n  return (createStore) => (reducer, preloadedState, enhancer) => {\n    var store = createStore(reducer, preloadedState, enhancer)\n    var dispatch = store.dispatch\n    var chain = []\n\n    var middlewareAPI = {\n      getState: store.getState,\n      dispatch: (action) => dispatch(action)\n    }\n    chain = middlewares.map(middleware => middleware(middlewareAPI))\n    dispatch = compose(...chain)(store.dispatch)\n\n    return {...store, dispatch}\n  }\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br")])])]),e._v(" "),t("li",[t("h4",{attrs:{id:"工作流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作流程"}},[e._v("#")]),e._v(" 工作流程")]),e._v(" "),t("ul",[t("li",[t("h5",{attrs:{id:"工作流程图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作流程图"}},[e._v("#")]),e._v(" 工作流程图")])])]),e._v(" "),t("p",[t("img",{attrs:{src:"http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091802.jpg",alt:"工作流程图"}})]),e._v(" "),t("ul",[t("li",[t("p",[e._v("用户发出 "),t("code",[e._v("Action")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("store.dispatch(action)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[t("code",[e._v("Store")]),e._v(" 自动调用 "),t("code",[e._v("Reducer")]),e._v("，并且传入两个参数：当前 "),t("code",[e._v("State")]),e._v(" 和收到的 "),t("code",[e._v("Action")]),e._v("。 "),t("code",[e._v("Reducer")]),e._v(" 会返回新的 "),t("code",[e._v("State")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("let nextState = todoApp(previousState, action)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[t("code",[e._v("State")]),e._v(" 一旦有变化，"),t("code",[e._v("Store")]),e._v(" 就会调用监听函数")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 设置监听函数\nstore.subscribe(listener)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])])]),e._v(" "),t("li",[t("p",[t("code",[e._v("listener")]),e._v("可以通过"),t("code",[e._v("store.getState()")]),e._v("得到当前状态。如果使用的是 "),t("code",[e._v("React")]),e._v("，这时可以触发重新渲染 "),t("code",[e._v("View")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function listerner() {\n  let newState = store.getState()\n  component.setState(newState)   \n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])])])])]),e._v(" "),t("li",[t("h4",{attrs:{id:"进阶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进阶"}},[e._v("#")]),e._v(" 进阶")]),e._v(" "),t("ul",[t("li",[t("h5",{attrs:{id:"中间件使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#中间件使用"}},[e._v("#")]),e._v(" 中间件使用")])])]),e._v(" "),t("p",[e._v("将中间件放在"),t("code",[e._v("applyMiddleware")]),e._v("方法之中，传入"),t("code",[e._v("createStore")]),e._v("方法，就完成了"),t("code",[e._v("store.dispatch()")]),e._v("的功能增强")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { applyMiddleware, createStore } from 'redux'\nimport createLogger from 'redux-logger'\nconst logger = createLogger()\n\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("p",[t("code",[e._v("createStore")]),e._v("方法可以接受整个应用的初始状态作为参数，那样的话，"),t("code",[e._v("applyMiddleware")]),e._v("就是第三个参数了")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const store = createStore(\n  reducer,\n  initial_state,\n  applyMiddleware(logger)\n)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("中间件的次序有讲究。"),t("code",[e._v("applyMiddleware")]),e._v("方法的三个参数，就是三个中间件。有的中间件有次序要求，使用前要查一下文档。比如，"),t("code",[e._v("logger")]),e._v("就一定要放在最后，否则输出结果会不正确")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const store = createStore(\n  reducer,\n  applyMiddleware(thunk, promise, logger)\n)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[t("h5",{attrs:{id:"redux-thunk-中间件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redux-thunk-中间件"}},[e._v("#")]),e._v(" redux-thunk 中间件")])])]),e._v(" "),t("p",[e._v("加载成功后（"),t("code",[e._v("componentDidMount")]),e._v("方法），它送出了（"),t("code",[e._v("dispatch")]),e._v("方法）一个 "),t("code",[e._v("Action")]),e._v("，向服务器要求数据 "),t("code",[e._v("fetchPosts(selectedSubreddit)")]),e._v("。这里的"),t("code",[e._v("fetchPosts")]),e._v("就是 "),t("code",[e._v("Action Creator")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("class AsyncApp extends Component {\n  componentDidMount() {\n    const { dispatch, selectedPost } = this.props\n    dispatch(fetchPosts(selectedPost))\n  }\n\n// ...\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("p",[t("code",[e._v("fetchPosts")]),e._v("是一个"),t("code",[e._v("Action Creator")]),e._v("（动作生成器），返回一个函数。这个函数执行后，先发出一个"),t("code",[e._v("Action（requestPosts(postTitle)")]),e._v("），然后进行异步操作。拿到结果后，先将结果转成 "),t("code",[e._v("JSON")]),e._v(" 格式，然后再发出一个 "),t("code",[e._v("Action")]),e._v("（ "),t("code",[e._v("receivePosts(postTitle, json)")]),e._v("）")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("\x3c!--Action Creator --\x3e\nconst fetchPosts = postTitle => (dispatch, getState) => {\n  dispatch(requestPosts(postTitle))\n  return fetch(`/some/API/${postTitle}.json`)\n    .then(response => response.json())\n    .then(json => dispatch(receivePosts(postTitle, json)))\n  }\n}\n\n// 使用方法一\nstore.dispatch(fetchPosts('reactjs'))\n// 使用方法二\nstore.dispatch(fetchPosts('reactjs')).then(() =>\n  console.log(store.getState())\n)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br")])]),t("p",[t("code",[e._v("Action")]),e._v(" 是由"),t("code",[e._v("store.dispatch")]),e._v("方法发送的。而"),t("code",[e._v("store.dispatch")]),e._v("方法正常情况下，参数只能是对象，不能是函数")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nimport reducer from './reducers'\n\n// Note: this API requires redux@>=3.1.0\nconst store = createStore(\n  reducer,\n  applyMiddleware(thunk)\n)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("  注意点：  \n  \n  - `fetchPosts`返回了一个函数，而普通的 `Action Creator` 默认返回一个对象\n  - 返回的函数的参数是`dispatch`和`getState`这两个 `Redux` 方法，普通的 `Action Creator` 的参数是 `Action` 的内容\n  - 在返回的函数之中，先发出一个 `Action`（`requestPosts(postTitle)`），表示操作开始\n  - 异步操作结束之后，再发出一个 `Action`（`receivePosts(postTitle, json)`），表示操作结束\n")])])]),t("ul",[t("li",[t("h5",{attrs:{id:"redux-promise-中间件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redux-promise-中间件"}},[e._v("#")]),e._v(" "),t("code",[e._v("redux-promise")]),e._v(" 中间件")])])]),e._v(" "),t("p",[t("code",[e._v("Action Creator")]),e._v(" 返回一个 "),t("code",[e._v("Promise")]),e._v(" 对象")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("import { createStore, applyMiddleware } from 'redux'\nimport promiseMiddleware from 'redux-promise'\nimport reducer from './reducers'\n\nconst store = createStore(\n  reducer,\n  applyMiddleware(promiseMiddleware)\n)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("p",[e._v("这个中间件使得"),t("code",[e._v("store.dispatch")]),e._v("方法可以接受 "),t("code",[e._v("Promise")]),e._v(" 对象作为参数。这时，"),t("code",[e._v("Action Creator")]),e._v(" 有两种写法。写法一，返回值是一个 "),t("code",[e._v("Promise")]),e._v(" 对象")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("\x3c!--写法一--\x3e\nconst fetchPosts = \n  (dispatch, postTitle) => new Promise(function (resolve, reject) {\n     dispatch(requestPosts(postTitle))\n     return fetch(`/some/API/${postTitle}.json`)\n       .then(response => {\n         type: 'FETCH_POSTS',\n         payload: response.json()\n       })\n})\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("p",[e._v("写法二，"),t("code",[e._v("Action")]),e._v(" 对象的"),t("code",[e._v("payload")]),e._v("属性是一个 "),t("code",[e._v("Promise")]),e._v(" 对象。这需要从"),t("code",[e._v("redux-actions")]),e._v("模块引入"),t("code",[e._v("createAction")]),e._v("方法")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("\x3c!--写法二--\x3e\nimport { createAction } from 'redux-actions'\n\nclass AsyncApp extends Component {\n  componentDidMount() {\n    const { dispatch, selectedPost } = this.props\n    // 发出同步 Action\n    dispatch(requestPosts(selectedPost));\n    // 发出异步 Action\n    dispatch(createAction(\n      'FETCH_POSTS', \n      fetch(`/some/API/${postTitle}.json`)\n        .then(response => response.json())\n    ))\n  }\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);