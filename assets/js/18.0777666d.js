(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{517:function(s,t,e){"use strict";e.r(t);var a=e(4),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("ul",[e("li",[e("h4",{attrs:{id:"细节问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#细节问题"}},[s._v("#")]),s._v(" 细节问题")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("图片宽度不能超过 "),e("code",[s._v("2048")])])]),s._v(" "),e("li",[e("p",[s._v("路径不能使用 "),e("code",[s._v("./")]),s._v(" ,并且区分大小写，不然在打包成微信小游戏会报错")])]),s._v(" "),e("li",[e("p",[s._v("创建场景时需要选择为分离模式才能生成UI配置文件")])]),s._v(" "),e("li",[e("p",[s._v("子域 "),e("code",[s._v("bitmap._addReference()")]),s._v(" 报错，也是因为版本太老，需要更新到最新引擎。 或则自己手动加个判断，判下 "),e("code",[s._v("bitmap._addReference")]),s._v(" 是否为 "),e("code",[s._v("null")])])]),s._v(" "),e("li",[e("p",[s._v("绘制开放域内容时需要添加背景，否则会模糊")])]),s._v(" "),e("li",[e("p",[s._v("使用了开放域组件后可能会产生掉帧问题（在安卓上表现比较明显，通常会掉到 "),e("code",[s._v("20-25")]),s._v(" 帧）,所以尽量避免在游戏过程中使用开放域，需要在不使用开放域的时候停止开放域渲染具体做法分 "),e("code",[s._v("1.0")]),s._v(" 和 "),e("code",[s._v("2.0")]),s._v(":")]),s._v(" "),e("p",[e("strong",[e("code",[s._v("1.0")]),s._v("做法:")])]),s._v(" "),e("p",[s._v("在使用开放域过程中开启：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//_subContextSprite是Laya.Texture类型元素，小程序使用，非常费\nthis._subTexture.bitmap.alwaysChange = true;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("在不使用开放域时设定：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//_subContextSprite是Laya.Texture类型元素\nthis._subContextSprite.visible = false;\n//_subTexture为子域画布元素,这里一定要设为false,不然会很卡\nthis._subTexture.bitmap.alwaysChange = false;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("em",[e("strong",[e("code",[s._v("2.0")]),s._v("做法:")])])]),s._v(" "),e("p",[s._v("在使用开放域过程中开启：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//_my_open为2.0增加的开放域组件\nthis._my_open.visible = true;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("在不使用开放域过程中移除开放与组件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this._my_open.removeSelf();\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])])]),s._v(" "),e("li",[e("h4",{attrs:{id:"微信开放域创建和注意点："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信开放域创建和注意点："}},[s._v("#")]),s._v(" 微信开放域创建和注意点：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("创建开放域")]),s._v(" "),e("p",[s._v("1、创建一个新工程，作为开放域工程"),e("br"),s._v("\n2、按照普通流程创建需要显示精灵等元素，并设置 "),e("code",[s._v("visible = false")]),e("br"),s._v("\n3、接收主域发送的信息标志添加数据并显示对应的开放域元素")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\x3c!--接收主域信息--\x3e\nLaya.Browser.window.wx.onMessage(data => {\n\tif (data.message == undefined) {\n\t\treturn;\n\t}\n\tlet jsonData = JSON.parse(data.message);\n\t\x3c!--根据信息所带的不同标志来控制对应的开放域元素的行为--\x3e\n\tswitch (jsonData.tag) {\n\t\tcase "hideRankView": {\n\t\t\tthis.rank.close();\n\t\t\tbreak;\n\t\t}\n\t\tcase "showRankView": {\n\t\t\tthis.openid = jsonData.data.openid;\n\t\t\tthis.getRankList()\n\t\t\tbreak;\n\t\t}\n\t}\n});\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("创建主域：")]),s._v(" "),e("p",[s._v("1、创建离屏画布（"),e("code",[s._v("1.0")]),s._v("需要自己手动绘制离屏画布，"),e("code",[s._v("2.0")]),s._v("提供了微信开放域组件）:")]),s._v(" "),e("p",[e("em",[e("strong",[e("code",[s._v("1.0")]),s._v("绘制离屏画布")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\x3c!--判断是否在微信小游戏环境中--\x3e\nif (Laya.Browser.onMiniGame) {\n    \x3c!--判断是否存在离屏画布--\x3e\n\tif (this._subCount == 0) {\n\t\tLaya.timer.once(200, this, function (): void {\n\t\t    \x3c!--创建离屏画布具体步骤--\x3e\n\t\t\tthis._subTexture = new Laya.Texture(Laya.Browser.window.sharedCanvas);\n\t\t\tthis._subTexture.bitmap.alwaysChange = true;\n\t\t\tthis._subTexture.mouseEnabled = false;\n\t\t\tthis._subContextSprite = new Laya.Sprite();\n\t\t\tthis._subContextSprite.mouseEnabled = false;\n\t\t\tthis._subContextSprite.size( Common.Config.WIDTH, Common.Config.HEIGHT);\n\t\t\tthis._subContextSprite.zOrder = 1000;\n\t\t\tLaya.stage.addChild(this._subContextSprite);\n\t\t\tthis._subContextSprite.graphics.drawTexture(this._subTexture, 0, 0, Common.Config.WIDTH, Common.Config.HEIGHT);\n\n\t\t\tcallback();\n\t\t});\n\t} else {\n\t    \x3c!--若存在离屏画布则直接控制其显示--\x3e\n\t\tthis._subContextSprite.visible = true;\n\t\tthis._subTexture.bitmap.alwaysChange = true;\n\t\tcallback();\n\t}\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[e("em",[e("strong",[e("code",[s._v("2.0")]),s._v("创建开放域组件")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\x3c!--添加开放域组件--\x3e\nthis._my_open = new Laya.WXOpenDataViewer();\nthis._my_open.width = 750;\nthis._my_open.height = 468;\nthis._my_open.pos((Laya.stage.width-this._my_open.width)/2,143)\nthis._my_open.zOrder = 10000;\nLaya.stage.addChild(this._my_open);\n\x3c!--设置为隐藏--\x3e\nthis._my_open.visible = false;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("2、发送消息给开放域，来控制开放域：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\x3c!--发信息到开放域--\x3e\nsendMsgToSub(strData: string) {\n\tif (Laya.Browser.onMiniGame) {\n\t\tLaya.Browser.window.wx.getOpenDataContext().postMessage({\n\t\t\tmessage: strData,\n\t\t})\n\t}\n}\nthis.sendMsgToSub(JSON.stringify({ tag: "hideRankView" }))\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("微信小程序配置：")]),s._v(" "),e("p",[s._v("1、将开放域工程打包成微信小程序，记得勾选***是否为微信开放数据域项目***")]),s._v(" "),e("p",[s._v("2、在主域的项目目录下新建开放域文件夹 "),e("code",[s._v("openDataContext")]),s._v(",文件夹名称随意，并将打包完的开放域项目代码复制到这个文件夹下，也可以在开放域项目打包时设定***发布目录***为这个文件夹，可以省去复制操作")]),s._v(" "),e("p",[s._v("3、打开主域的"),e("code",[s._v("game.json")]),s._v("文件，并添加")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('//openDataContext对应的是开放域所在的文件夹名称\n"openDataContext": "openDataContext"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("注意点：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("开放域组件或离屏画布似乎不能绘制在弹窗上，所以只能直接添加到舞台当中并设定层级高一点")])]),s._v(" "),e("li",[e("p",[s._v("在绘制开放域的过程中，若不涉及数据实时更新的问题，则可以提前绘制，只控制显隐，若涉及数据实时更新的问题，在主域控制开放域显隐之前先拿到最新数据并提前绘制好开放域元素，总的就是需要提前绘制。因为开放域获取数据和绘制需要一定的时候，如果在还没绘制完开放域，主域就控制开放域隐藏元素，会失效导致开放域不能被隐藏，出现"),e("code",[s._v("bug")])])])])])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);