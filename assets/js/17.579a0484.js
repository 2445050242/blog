(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{518:function(s,e,a){"use strict";a.r(e);var n=a(4),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("ul",[a("li",[a("h2",{attrs:{id:"分享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分享"}},[s._v("#")]),s._v(" 分享")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")])])]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("onShareAppMessage")]),s._v("配置分享信息  "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("配置链接"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("监听用户点击页面内转发按钮（"),a("code",[s._v("Button")]),s._v(" 组件 "),a("code",[s._v("openType='share'")]),s._v("）或右上角菜单“转发”按钮的行为，并自定义转发内容")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("onShareAppMessage (res) {\n    // 转发事件来源：button：页面内转发按钮，menu：右上角转发菜单\n    if (res.from === 'button') { \n        console.log(res.target)\n    }\n    // 配置分享信息\n    return {\n        title: '自定义转发标题',\n        path: '/page/user?id=123',\n        imageUrl: '分享图片链接'\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"小程序分享互跳方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序分享互跳方案"}},[s._v("#")]),s._v(" 小程序分享互跳方案")])])]),s._v(" "),a("p",[s._v("由于小程序分享或者服务通知只能实现跳转到源小程序，如果遇到需要跳转其他小程序需求，可采用新增一个分享中转页来跳转其他小程序，并将分享或服务通知中的路径修改为中转页路径")])]),s._v(" "),a("li",[a("h4",{attrs:{id:"canvas生成海报"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#canvas生成海报"}},[s._v("#")]),s._v(" canvas生成海报")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"小程序码生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序码生成"}},[s._v("#")]),s._v(" 小程序码生成")])])]),s._v(" "),a("p",[s._v("==只能生成正式版==")]),s._v(" "),a("p",[s._v("生成的三种方式：")]),s._v(" "),a("p",[s._v("1、"),a("code",[s._v("wxacode.createQRCode")]),s._v(" 适用于需要的码数量较少的业务场景。通过该接口生成的小程序码，永久有效，有数量限制 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.createQRCode.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("2、"),a("code",[s._v("wxacode.get")]),s._v(" 适用于需要的码数量较少的业务场景。通过该接口生成的小程序码，永久有效，有数量限制 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.get.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("3、"),a("code",[s._v("wxacode.getUnlimited")]),s._v(" 适用于需要的码数量极多的业务场景。通过该接口生成的小程序码，永久有效，数量暂无限制。链接后面不能带参数，参数只能放在"),a("code",[s._v("scene")]),s._v("属性中，且限制长度为最大"),a("code",[s._v("32")]),s._v("个可见字符 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("区别")]),s._v(" "),a("th",[s._v("createQRCode/get")]),s._v(" "),a("th",[s._v("getUnlimited")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("数量")]),s._v(" "),a("td",[s._v("有限，总共生成的码数量限制为 100,000")]),s._v(" "),a("td",[s._v("无限")])]),s._v(" "),a("tr",[a("td",[s._v("参数")]),s._v(" "),a("td",[s._v("放在path参数后，最大长度 128 字节")]),s._v(" "),a("td",[s._v("放在scene参数内，最大32个可见字符，只支持数字，大小写英文以及部分特殊字符")])]),s._v(" "),a("tr",[a("td",[s._v("适合场景")]),s._v(" "),a("td",[s._v("需要的码数量较少")]),s._v(" "),a("td",[s._v("需要的码数量极多")])])])]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"canvas实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#canvas实现"}},[s._v("#")]),s._v(" "),a("code",[s._v("canvas")]),s._v("实现")])])]),s._v(" "),a("p",[a("code",[s._v("canvas")]),s._v("绘制图片只能使用本地图片,对于网络图片或者"),a("code",[s._v("base64")]),s._v("图片需做处理")]),s._v(" "),a("p",[s._v("1、网络图片处理（例如微信头像等）需要先==在后台配置"),a("code",[s._v("download")]),s._v("域名==才能生效 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.getImageInfo.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 使用getImageInfo获取图片的本地链接信息\nconst { path } = Taro.getImageInfo({\n    src: userInfo.avatarUrl\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("2、"),a("code",[s._v("base64")]),s._v("图片处理（例如小程序码）"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.writeFileSync.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const save = Taro.getFileSystemManager()\nconst number = Math.random()\nconst filePath = Taro.env.USER_DATA_PATH + '/pic' + number + '.png'\n\nawait save.writeFileSync(filePath, qrcode.slice(22), 'base64')\n\nreturn filePath\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("code",[s._v("canvas")]),s._v("生成流程")]),s._v(" "),a("p",[s._v("1、添加"),a("code",[s._v("canvas")]),s._v("模板")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<Canvas className='share__canvas' style='width: 375px; height: 667px' canvasId='canvas' />\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2、创建 "),a("code",[s._v("canvas")]),s._v(" 的绘图上下文 "),a("code",[s._v("CanvasContext")]),s._v(" 对象  "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.createCanvasContext.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("第一个参数为要获取上下文的 "),a("code",[s._v("canvas")]),s._v(" 组件 "),a("code",[s._v("canvas-id")]),s._v(" 属性")]),s._v(" "),a("p",[s._v("第二个参数为在自定义组件下，当前组件实例的"),a("code",[s._v("this")]),s._v("，表示在这个自定义组件下查找拥有 "),a("code",[s._v("canvas-id")]),s._v(" 的 "),a("code",[s._v("canvas")]),s._v(" ，如果省略则不在任何自定义组件内查找")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const canvas = Taro.createCanvasContext('canvas', this.$scope)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("3、绘制"),a("code",[s._v("canvas")]),s._v(" "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasToTempFilePath.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("code",[s._v("canvasToTempFilePath")]),s._v(" 把当前画布指定区域的内容导出生成指定大小的图片。在 "),a("code",[s._v("draw()")]),s._v(" 回调里调用该方法才能保证图片导出成功")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/** 绘制canvas */\ngetCanvas = async (text, context) => {\n    const that = this\n    const { imgList } = this.state\n    for (let i = 0; i < imgList.length; i++) {\n        // 遍历渲染所需图片资源\n        await this.drawImg(imgList[i], context)\n        if (i === imgList.length - 1) {\n            // 绘制文案\n            context.fillStyle = '#ffffff'\n            context.font = '12px 微软雅黑'\n            context.fillText(text, 63, 26)\n            context.draw(true, () => {\n                Taro.canvasToTempFilePath({\n                    height: 1334,  // 绘制的canvas高度\n                    canvasId: 'canvas', // 画布标识，传入 canvas 组件实例\n                    success(res) {\n                        // canvas绘制成功执行回调，res.tempFilePath为canvas图片临时路径\n                    },\n                    fail(err) {\n                        // 绘制失败提示\n                        Taro.showToast({\n                            title: '生成图片失败！',\n                            icon: 'none',\n                            duration: 2000\n                        })\n                    },\n                    complete() {\n                        // 绘制完成\n                    }\n                }, this.$scope) // 在自定义组件下，当前组件实例的this，以操作组件内 canvas 组件\n            })\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"图片保存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片保存"}},[s._v("#")]),s._v(" 图片保存")])])]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("canvasToTempFilePath")]),s._v("保存图片到系统相册 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.saveImageToPhotosAlbum.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const { errMsg } = await Taro.saveImageToPhotosAlbum({\n    // 可以是临时文件路径或永久文件路径 (本地路径) ，不支持网络路径\n    filePath: '需要保存的图片路径'\n})\n\nif (errMsg === 'saveImageToPhotosAlbum:ok') {\n    Taro.showToast({\n        title: '保存成功',\n        icon: 'success',\n        duration: 2000\n    })\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("两个需要==注意的地方==：")]),s._v(" "),a("p",[s._v("1、用户拒绝授权保存图片之后，再次点击保存图片微信会默认拒绝，不会再次弹出授权弹窗，所以需要打开设置界面，让用户手动开启权限 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.openSetting.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 创建设置按钮openType='openSetting'\n<Button className='share__item' openType='openSetting' onOpenSetting={this.onOpenSetting}>\n  <Image src={IconFriend} className='share__item-icon' />\n  <View className='share__item-text'>保存相册后发好友或朋友圈</View>\n</Button>\n\n// 回调方法判断用户是否开启权限并做相应处理\nonOpenSetting = res => {\n    this.setState({\n        showSetting: !res.detail.authSetting['scope.writePhotosAlbum']\n    })\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("2、打开设置界面，用户有可能在设置权限界面关闭用户信息权限，需要做相应处理，比如在设置回调函数中判断是否拒绝用户信息权限，或者设置"),a("code",[s._v("componentDidShow")])])]),s._v(" "),a("li",[a("h4",{attrs:{id:"微信支付"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微信支付"}},[s._v("#")]),s._v(" 微信支付")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"安卓使用小程序内微信支付-wx-requestpayment-object-object"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安卓使用小程序内微信支付-wx-requestpayment-object-object"}},[s._v("#")]),s._v(" 安卓使用小程序内微信支付 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/payment/wx.requestPayment.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("wx.requestPayment(Object object)")]),a("OutboundLink")],1)])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Taro.requestPayment({\n    timeStamp: payInfo.timeStamp.toString(), // 时间戳\n    package: payInfo.package, // 统一下单接口返回的 prepay_id 参数值\n    signType: payInfo.signType, // MD5签名算法\n    nonceStr: payInfo.nonceStr, // 随机字符串，长度为32个字符以下\n    paySign: payInfo.sign, // 签名\n    success() {\n        // 支付成功\n        Taro\n            .showToast({ icon: 'success', title: '支付成功' })\n            .then(() => dispatch(onUpgradeCourse(true)))\n            .then(() => dispatch(toggleCouponBar(false)))\n        // 可以在这里做购买服务通知\n    },\n    fail() {\n        // 支付失败\n        Taro\n            .showToast({ icon: 'none', title: '支付失败' })\n            .then(() => dispatch(onUpgradeCourse(false)))\n    }\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"ios不支持小程序内微信支付，通过客服消息跳转h5页面使用h5支付-wx-choosewxpay"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ios不支持小程序内微信支付，通过客服消息跳转h5页面使用h5支付-wx-choosewxpay"}},[s._v("#")]),s._v(" "),a("code",[s._v("IOS")]),s._v("不支持小程序内微信支付，通过客服消息跳转"),a("code",[s._v("H5")]),s._v("页面使用"),a("code",[s._v("H5")]),s._v("支付 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#58",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("wx.chooseWXPay")]),a("OutboundLink")],1)])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// wx config\nwx.config({\n    debug: process.env.NODE_ENV === 'development',\n    appId: signPackage.appId,\n    nonceStr: signPackage.nonceStr,\n    signature: signPackage.signature,\n    timestamp: signPackage.timestamp,\n    jsApiList: ['chooseWXPay']\n})\n\n// wx ready\nwx.ready(() => {\n    wx.chooseWXPay({\n        appId: payInfo.appId,\n        timestamp: payInfo.timeStamp, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符\n        nonceStr: payInfo.nonceStr, // 支付签名随机串，不长于 32 位\n        package: payInfo.package, // 统一支付接口返回的prepay_id参数值\n        paySign: payInfo.paySign, // 支付签名\n        signType: payInfo.signType, // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'\n        success() {\n            // 支付成功后的回调函数\n        },\n        fail() {\n            // 支付失败\n        },\n        cancel() {\n            // 取消支付\n        }\n    })\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"注意点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意点"}},[s._v("#")]),s._v(" 注意点")])])]),s._v(" "),a("p",[s._v("开发公众号支付，需要在微信商户号内配置支付授权目录，才能在微信内唤起微信支付\n"),a("a",{attrs:{href:"https://www.jianshu.com/p/a6eb53a2c96a",target:"_blank",rel:"noopener noreferrer"}},[s._v("配置方法"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("h4",{attrs:{id:"消息推送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息推送"}},[s._v("#")]),s._v(" 消息推送")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"需在微信后台-订阅消息模块内添加消息模板-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需在微信后台-订阅消息模块内添加消息模板-详情"}},[s._v("#")]),s._v(" 需在微信后台->订阅消息模块内添加消息模板 "),a("a",{attrs:{href:"https://www.jianshu.com/p/68d58faa4877",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("h5",{attrs:{id:"调起客户端小程序订阅消息界面，返回用户订阅消息的操作结果-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调起客户端小程序订阅消息界面，返回用户订阅消息的操作结果-详情"}},[s._v("#")]),s._v(" 调起客户端小程序订阅消息界面，返回用户订阅消息的操作结果 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Taro.requestSubscribeMessage({\n    // tmplIds需使用微信后台配置对应生成的模板id\n    tmplIds: ['uLSLL47inAKf7QUP8UnxF1tuItsB7_KMzJloJVIoCsM'],\n    success(res) {\n        // 请求服务端订阅接口，服务端再发送订阅消息\n        console.log('订阅成功', res)\n    },\n    fail(res) {\n        console.log('订阅失败', res)\n    }\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"服务端使用subscribemessage-send发送订阅消息-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端使用subscribemessage-send发送订阅消息-详情"}},[s._v("#")]),s._v(" 服务端使用"),a("code",[s._v("subscribeMessage.send")]),s._v("发送订阅消息 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)])])]),s._v(" "),a("p",[a("code",[s._v("page")]),s._v(" 点击模板卡片后的跳转页面，仅限本小程序内的页面。支持带参数,（示例"),a("code",[s._v("index?foo=bar")]),s._v("）。该字段不填则模板无跳转")]),s._v(" "),a("p",[a("code",[s._v("miniprogram_state")]),s._v(" 跳转小程序类型："),a("code",[s._v("developer")]),s._v("为开发版；"),a("code",[s._v("trial")]),s._v("为体验版；"),a("code",[s._v("formal")]),s._v("为正式版；默认为正式版")])]),s._v(" "),a("li",[a("h4",{attrs:{id:"微信分享"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微信分享"}},[s._v("#")]),s._v(" 微信分享")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"index-html文件引入微信jssdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index-html文件引入微信jssdk"}},[s._v("#")]),s._v(" "),a("code",[s._v("index.html")]),s._v("文件引入微信"),a("code",[s._v("JSSDK")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"><\/script>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"分享信息配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分享信息配置"}},[s._v("#")]),s._v(" 分享信息配置")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 分享\nuseEffect(async () => {\n    // 获取分享信息\n    const { data } = await Http.post('/?r=api&m=weixinShare&ac=jsShare')\n    const wx_share = {\n        title: '猫小帅识字打卡0元学',\n        content: '快来一起参加打卡0元学，1200+汉字，玩、认、读、练结合，快速提升识字量。',\n        pic: 'https://pic.haizi369.com/s1/work/material/20200324/3135a8cd012c2ef5a0f0c92e22eca1e2.jpg',\n        url: `${window.location.origin}/udc/wap/sign-in/?share=${/Android/i.test(\n            navigator.userAgent\n          )}#/share`\n    }\n    wx.config({\n        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\n        appId: data.appId, // 必填，公众号的唯一标识\n        timestamp: data.timestamp, // 必填，生成签名的时间戳\n        nonceStr: data.nonceStr, // 必填，生成签名的随机串\n        signature: data.signature, // 必填，签名\n        jsApiList: [\n            'onMenuShareTimeline',\n            'onMenuShareAppMessage',\n            'onMenuShareQQ'\n        ] // 必填，需要使用的JS接口列表\n    })\n\n    // 配置各个分享渠道\n    wx.ready(() => {\n        wx.onMenuShareQQ({\n            title: wx_share.title, // 分享标题\n            desc: wx_share.content, // 分享描述\n            link: wx_share.url, // 分享链接\n            imgUrl: wx_share.pic // 分享图标\n        })\n        wx.onMenuShareTimeline({\n            title: wx_share.title, // 分享标题\n            link: wx_share.url, // 分享链接\n            desc: wx_share.content, // 分享描述\n            imgUrl: wx_share.pic // 分享图标\n        })\n        wx.onMenuShareAppMessage({\n            title: wx_share.title, // 分享标题\n            link: wx_share.url, // 分享链接\n            desc: wx_share.content, // 分享描述\n            imgUrl: wx_share.pic // 分享图标\n        })\n    })\n}, [])\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"解决-react-vue-安卓分享链接会被忽略掉hash参数，导致分享页面全部跳回首页问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决-react-vue-安卓分享链接会被忽略掉hash参数，导致分享页面全部跳回首页问题"}},[s._v("#")]),s._v(" 解决 "),a("code",[s._v("react/vue")]),s._v(" 安卓分享链接会被忽略掉"),a("code",[s._v("hash")]),s._v("参数，导致分享页面全部跳回首页问题")])])]),s._v(" "),a("p",[s._v("判断为安卓时分享链接添加"),a("code",[s._v("share=true")]),s._v("参数，然后在"),a("code",[s._v("index.html")]),s._v("中判断"),a("code",[s._v("share")]),s._v("参数为真时则自动拼接上真正需要跳转的链接地址")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 获取链接参数\nfunction getQueryString() {\n    var reg = new RegExp(`(^|&)${'share'}=([^&]*)(&|$)`);\n    var r = window.location.search.substr(1).match(reg);\n    if (r != null) return unescape(r[2]);\n    return '';\n}\n\n// 替换url\nfunction urlReplace() {\n    var url = window.location.href\n    if (url.indexOf('share') > 0) {\n        history.pushState('', 'Title', url.replace(/share=true/g, ''))\n    }\n}\n\n// 判断为安卓分享时，替换url并跳转拼接后的真实分享地址\nif (getQueryString('share') === 'true') {\n    urlReplace();\n    window.location.href = window.location.origin + '/udc/wap/sign-in/#/share';\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"注意点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意点-2"}},[s._v("#")]),s._v(" 注意点")])])]),s._v(" "),a("p",[s._v("1、本地无法测试微信分享功能，可通过微信开发者工具模拟调试")]),s._v(" "),a("p",[s._v("2、涉及到的接口域名需要在本地后台配置安全域名")])]),s._v(" "),a("li",[a("h4",{attrs:{id:"视频调用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频调用"}},[s._v("#")]),s._v(" 视频调用")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"创建video模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建video模板"}},[s._v("#")]),s._v(" 创建"),a("code",[s._v("video")]),s._v("模板")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<Video\n    autoplay={false} // 是否自动播放\n    showCenterPlayBtn={false} // 是否显示视频中间的播放按钮\n    showFullscreenBtn={false} // 是否显示全屏按钮\n    showPlayBtn={this.state.showPlayBtn} // 是否显示视频底部控制栏的播放按钮\n    title='视频介绍'\n    id='video'\n    src={video}\n    className='video__main'\n    onFullscreenChange={this.onFullscreenChange} // 全屏播放事件\n/>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"创建-video-上下文-videocontext-对象-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-video-上下文-videocontext-对象-详情"}},[s._v("#")]),s._v(" 创建 "),a("code",[s._v("video")]),s._v(" 上下文 "),a("code",[s._v("VideoContext")]),s._v(" 对象 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.createVideoContext.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 第一个参数为video 组件的 id，第二个参数为在自定义组件下，当前组件实例的this，以操作组件内 video 组件\nconst videoContext = Taro.createVideoContext('video', this)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("h4",{attrs:{id:"节点选取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点选取"}},[s._v("#")]),s._v(" 节点选取")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"createselectorquery-返回一个-selectorquery-对象实例。在自定义组件或包含自定义组件的页面中，应使用-this-createselectorquery-来代替-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createselectorquery-返回一个-selectorquery-对象实例。在自定义组件或包含自定义组件的页面中，应使用-this-createselectorquery-来代替-详情"}},[s._v("#")]),s._v(" "),a("code",[s._v("createSelectorQuery")]),s._v(" 返回一个 "),a("code",[s._v("SelectorQuery")]),s._v(" 对象实例。在自定义组件或包含自定义组件的页面中，应使用 "),a("code",[s._v("this.createSelectorQuery()")]),s._v(" 来代替 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wxml/wx.createSelectorQuery.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const query = Taro.createSelectorQuery()\n// select(string selector) 在当前页面下选择第一个匹配选择器 selector 的节点。返回一个 NodesRef 对象实例\n// boundingClientRect() 添加节点的布局位置的查询请求。相对于显示区域，以像素为单位\nquery.select('#j-tab').boundingClientRect()\n// 执行所有的请求。请求结果按请求次序构成数组，在callback的第一个参数中返回\nquery.exec(res => {\n    this.setState({ tabOffsetTop: res[0].top })\n})\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])]),s._v(" "),a("li",[a("h4",{attrs:{id:"网络监测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络监测"}},[s._v("#")]),s._v(" 网络监测")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"获取当前网络状况-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取当前网络状况-详情"}},[s._v("#")]),s._v(" 获取当前网络状况 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.getNetworkType.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Taro.getNetworkType({\n    success: res => {\n        if (res.networkType === 'none') {\n            // 无网情况\n        } else {\n            // 有网，可继续区分网络类型\n        }\n    }\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[a("h5",{attrs:{id:"监听网络变化-详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监听网络变化-详情"}},[s._v("#")]),s._v(" 监听网络变化 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.onNetworkStatusChange.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详情"),a("OutboundLink")],1)])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("let supportWx = false\n// 备注：taro没有取消监听网络状态变化事件API，所有这里直接采用微信小程序原生api\n// 由于网络监听是全局的，所以每次设置监听之前应该先取消监听\nif (wx && wx.offNetworkStatusChange) {\n    wx.offNetworkStatusChange()\n    supportWx = true\n}\nTaro.onNetworkStatusChange(res => {\n    Taro.hideLoading()\n    if (!this.onLine && res.isConnected) {\n        // 如果有传入回调方法，则在恢复断网时执行，可传入页面数据请求\n        supportWx && callback && callback()\n    }\n    this.onLine = res.isConnected\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])])])])}),[],!1,null,null,null);e.default=t.exports}}]);